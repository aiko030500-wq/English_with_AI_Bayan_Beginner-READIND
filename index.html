<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Beginner READING</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --blue-main:#6d3b0f;   /* —Ç—ë–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
      --blue-soft:#a5621c;   /* —Ç—ë–ø–ª—ã–π –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π */
      --gold:#ffd54f;
      --bg:#f4f3ef;
      --topicColor:#6d3b0f;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#3b2b20;
    }

    /* HEADER */
    header{
      background:linear-gradient(90deg,#6d3b0f,#a5621c);
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:50px;
      height:50px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#7a6a5c;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d6c8bc;
      margin-bottom:14px;
      font-size:14px;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(165,98,28,.2);
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--blue-soft);
      color:#fff;
    }
    .btn-primary:hover{background:#8d4f17;}
    .btn-ghost{
      background:#f3e6da;
      color:#5b3311;
    }
    .btn-ghost:hover{background:#e7d6c7;}

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* SCREENS */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      background:#ffe8c2;
      font-size:11px;
      color:#5b3311;
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff9e5;
      border:1px solid #ffe082;
      font-size:12px;
    }
    .star-icon{color:#ffb300;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #e0d4c6;
      padding:10px 12px;
      background:#f9f6f2;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#f3e6da;
      transform:translateY(-1px);
    }
    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }
    .topic-card-sub{
      font-size:11px;
      color:#7a6a5c;
    }

    /* AI PANEL (demo) */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }
    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{
      font-size:11px;
    }
    .chat-note{
      font-size:11px;
      color:#7a6a5c;
    }
    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #e0d4c6;
      padding:8px;
      background:#f9f6f2;
      font-size:13px;
      overflow-y:auto;
    }
    .chat-msg{
      margin-bottom:6px;
      line-height:1.4;
    }
    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #d6c8bc;
      padding:8px;
      font-size:13px;
      margin-top:4px;
    }

    /* TOPIC SCREEN */
    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }
    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),#a5621c);
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .topic-header-main{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }
    .topic-header-tag{
      font-size:11px;
      opacity:.9;
    }
    .topic-header-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-topic.back{
      background:#ffffff;
      color:var(--topicColor);
    }
    .btn-topic.menu{
      background:rgba(255,255,255,.15);
      color:#fff;
      border:1px solid rgba(255,255,255,.5);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:16px;
    }

    .reading-box{
      background:#fdf7f0;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:12px;
      font-size:14px;
      line-height:1.5;
    }
    .reading-box p{margin-top:6px;}
    .reading-vocab{
      margin-top:8px;
      font-size:13px;
      color:#4b382a;
    }

    .examples{
      margin-top:8px;
      font-size:13px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
    }

    .exercises{
      margin-top:12px;
    }
    .exercise-block{
      border-radius:12px;
      background:#f9f6f2;
      padding:10px 12px;
      margin-bottom:10px;
      border:1px solid #e0d4c6;
    }
    .exercise-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:4px;
    }
    .exercise-desc{
      font-size:12px;
      color:#7a6a5c;
      margin-bottom:6px;
    }
    .question-row{
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:6px;
    }
    .question-text{
      flex:1 1 160px;
    }
    .options{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .options label{
      background:#ffffff;
      border-radius:999px;
      border:1px solid #e0d4c6;
      padding:2px 8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:3px;
    }
    .options input[type="radio"]{
      accent-color:var(--topicColor);
    }
    .mark{
      width:18px;
      text-align:center;
      font-size:16px;
      font-weight:700;
    }
    .mark.correct{color:#2e7d32;}
    .mark.wrong{color:#c62828;}
    .exercise-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .exercise-footer small{
      font-size:11px;
      color:#7a6a5c;
    }

    /* TEACHER */
    #teacherScreen{
      margin-top:20px;
    }
    .top-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .table-wrapper{
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      margin-top:10px;
    }
    th,td{
      border:1px solid #e0d4c6;
      padding:6px 8px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#f3e6da;
      font-weight:600;
    }

    /* PRINT: only topic */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{
        background:#fff;
      }
      #topicScreen{
        display:block !important;
        margin:0;
        padding:0;
      }
      .topic-body{
        box-shadow:none;
        border-radius:0;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <img src="logo.png" alt="AI Bayan" class="logo-img">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Beginner ¬∑ stars ¬∑ reading texts</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>
  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted" style="margin-bottom:10px">
      Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.
    </p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name" />

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code" />

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>

  <!-- MAIN MENU (STUDENT) -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title" style="margin-bottom:4px;">Beginner topics ‚Äì Reading</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit">¬∑ demo mode</span>
        </h3>
        <p class="chat-note">
          In the future AI Bayan will help with reading texts and vocabulary.
        </p>
      </div>

      <div id="chatBox" class="chat-box">
        <div class="chat-msg">
          AI chat is not active in this demo. Now use reading texts and exercises.
        </div>
      </div>

      <div>
        <textarea id="aiQuestion"
                  placeholder="AI chat will be available soon."
                  disabled></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask (soon)</button>
        </div>
        <p class="chat-note">
          Later your questions and answers will be visible for the teacher.
        </p>
      </div>
    </aside>
  </section>

  <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-main">
        <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
        <div class="topic-header-tag" id="topicHeaderTag"></div>
      </div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè† Main menu</button>
        <button class="btn-topic menu" onclick="printCurrentTopic()">üñ® Print</button>
      </div>
    </div>
    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted" style="margin-top:8px;"></div>
    </div>
  </section>

  <!-- TEACHER -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back to login</button>
      <span class="tag">Teacher mode</span>
    </div>
    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">
      Shows data saved in this browser: stars and last login (per code).
    </p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
        <tr>
          <th>Class</th>
          <th>Code</th>
          <th>Name</th>
          <th>Stars</th>
          <th>Last login</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for (const r of classRanges){
    if (num >= r.from && num <= r.to){
      return r.cls;
    }
  }
  return null;
}

/* ---------- TOPIC COLORS ---------- */
const topicColors = {
  1:"#a5621c",
  2:"#8b4513",
  3:"#bd6325",
  4:"#b76e3a",
  5:"#7b4b23",
  6:"#c47a34"
};

/* ---------- READING TOPICS (6) ---------- */
const topics = [
  {
    id:1,
    name:"About Me",
    level:"Beginner",
    title:"All About Me",
    readingText:"My name is Aigerim and I am eleven years old. I live in a flat in the city with my parents and my little brother. On weekdays I go to school and do my homework in the afternoon. In my free time I like reading stories, listening to music and chatting with my friends. I am friendly and usually in a good mood, but I can be shy with new people.",
    vocab:"flat ‚Äì –∫–≤–∞—Ä—Ç–∏—Ä–∞; shy ‚Äì —Å—Ç–µ—Å–Ω–∏—Ç–µ–ª—å–Ω—ã–π; in a good mood ‚Äì –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏.",
    examples:[
      "I am eleven years old.",
      "I live in a flat with my family.",
      "I can be shy with new people."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Read the sentences and choose True (T) or False (F).",
        questions:[
          {
            text:"Aigerim lives alone in a big house.",
            options:["True","False"],
            correct:1
          },
          {
            text:"She has a little brother.",
            options:["True","False"],
            correct:0
          },
          {
            text:"She is always very confident with new people.",
            options:["True","False"],
            correct:1
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice ‚Äì details",
        desc:"Choose the correct answer (A, B or C).",
        questions:[
          {
            text:"Where does Aigerim live?",
            options:["In a village house.","In a flat in the city.","In a school dormitory."],
            correct:1
          },
          {
            text:"When does she do her homework?",
            options:["In the morning before school.","In the afternoon.","Late at night."],
            correct:1
          },
          {
            text:"What does she like doing in her free time?",
            options:["Reading, listening to music and chatting.","Only sleeping.","Only doing sports."],
            correct:0
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary ‚Äì choose the best word",
        desc:"Choose the correct word from the text.",
        questions:[
          {
            text:"The word for 'apartment' in the text is‚Ä¶",
            options:["flat","mood","desk"],
            correct:0
          },
          {
            text:"If you are 'shy', you‚Ä¶",
            options:["talk to everybody easily.","are quiet with new people.","always shout."],
            correct:1
          },
          {
            text:"'In a good mood' means‚Ä¶",
            options:["in a bad mood.","angry.","happy and positive."],
            correct:2
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose the best title for the text.",
        questions:[
          {
            text:"The main idea of the text is‚Ä¶",
            options:[
              "Aigerim‚Äôs school timetable.",
              "Aigerim‚Äôs daily routine at work.",
              "A short description of Aigerim and her life."
            ],
            correct:2
          }
        ]
      }
    ]
  },
  {
    id:2,
    name:"My Family",
    level:"Beginner",
    title:"My Friendly Family",
    readingText:"I have a small but friendly family. There are four people in my family: my mum, my dad, my younger brother and me. My mum is a doctor, she is very kind and patient. My dad works as an engineer and likes fixing things at home. My brother is eight, he is noisy but funny. In the evenings we often have dinner together and talk about our day.",
    vocab:"engineer ‚Äì –∏–Ω–∂–µ–Ω–µ—Ä; patient ‚Äì —Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π; noisy ‚Äì —à—É–º–Ω—ã–π.",
    examples:[
      "There are four people in my family.",
      "My mum is kind and patient.",
      "We have dinner together in the evenings."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Choose T or F.",
        questions:[
          {
            text:"There are five people in the family.",
            options:["True","False"],
            correct:1
          },
          {
            text:"The mum is a doctor.",
            options:["True","False"],
            correct:0
          },
          {
            text:"The brother is quiet and never noisy.",
            options:["True","False"],
            correct:1
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice ‚Äì details",
        desc:"Answer the questions.",
        questions:[
          {
            text:"What is the father‚Äôs job?",
            options:["Teacher.","Engineer.","Driver."],
            correct:1
          },
          {
            text:"How old is the brother?",
            options:["Eight.","Ten.","Twelve."],
            correct:0
          },
          {
            text:"What do they often do in the evenings?",
            options:["Watch TV separately.","Have dinner together and talk.","Go to different houses."],
            correct:1
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary",
        desc:"Choose the correct explanation.",
        questions:[
          {
            text:"A person who helps in a hospital is a‚Ä¶",
            options:["doctor","engineer","driver"],
            correct:0
          },
          {
            text:"If a person is 'patient', they‚Ä¶",
            options:["get angry quickly.","can wait and stay calm.","never listen."],
            correct:1
          },
          {
            text:"If a child is 'noisy', they‚Ä¶",
            options:["make a lot of sound.","sleep all day.","never speak."],
            correct:0
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose the best title.",
        questions:[
          {
            text:"The text is mostly about‚Ä¶",
            options:[
              "a school party.",
              "a small but friendly family.",
              "a trip to the city."
            ],
            correct:1
          }
        ]
      }
    ]
  },
  {
    id:3,
    name:"Friends",
    level:"Beginner",
    title:"My Best Friend",
    readingText:"My best friend‚Äôs name is Timur. We study in the same class, so we see each other every day. Timur is tall and slim, he has short dark hair and brown eyes. He is very helpful and always shares his things. After school we often play football or go for a walk in the park. When I have a problem, Timur listens and tries to help me.",
    vocab:"slim ‚Äì —Å—Ç—Ä–æ–π–Ω—ã–π; helpful ‚Äì –≥–æ—Ç–æ–≤—ã–π –ø–æ–º–æ—á—å; share ‚Äì –¥–µ–ª–∏—Ç—å—Å—è.",
    examples:[
      "Timur is in the same class.",
      "We often play football together.",
      "He listens when I have a problem."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Mark T or F.",
        questions:[
          {
            text:"Timur is the writer‚Äôs cousin.",
            options:["True","False"],
            correct:1
          },
          {
            text:"They study in the same class.",
            options:["True","False"],
            correct:0
          },
          {
            text:"Timur never shares his things.",
            options:["True","False"],
            correct:1
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice",
        desc:"Choose the correct answer.",
        questions:[
          {
            text:"What does Timur look like?",
            options:[
              "Short and strong.",
              "Tall and slim with short dark hair.",
              "Very small with long hair."
            ],
            correct:1
          },
          {
            text:"What do they often do after school?",
            options:[
              "Play football or walk in the park.",
              "Go to work.",
              "Cook dinner at school."
            ],
            correct:0
          },
          {
            text:"What does Timur do when the writer has a problem?",
            options:[
              "He laughs.",
              "He ignores it.",
              "He listens and tries to help."
            ],
            correct:2
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary",
        desc:"Choose the correct word from the text.",
        questions:[
          {
            text:"If a friend is 'helpful', they‚Ä¶",
            options:["never help.","often help other people.","always shout."],
            correct:1
          },
          {
            text:"If you 'share' your things, you‚Ä¶",
            options:[
              "keep everything only for yourself.",
              "give or lend them to other people.",
              "throw them away."
            ],
            correct:1
          },
          {
            text:"'Slim' is close in meaning to‚Ä¶",
            options:["thin","tall","heavy"],
            correct:0
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose the best sentence.",
        questions:[
          {
            text:"The main idea of the text is‚Ä¶",
            options:[
              "a description of a good friend.",
              "a story about a school test.",
              "rules of a football game."
            ],
            correct:0
          }
        ]
      }
    ]
  },
  {
    id:4,
    name:"Hobbies",
    level:"Beginner",
    title:"My Hobbies",
    readingText:"I have several hobbies. My favourite one is drawing. I like using bright colours and drawing animals and people. At the weekend I sometimes take my sketchbook to the park and draw trees or buildings. I also enjoy playing the guitar in the evening. Hobbies help me relax after school and forget about difficult tests.",
    vocab:"sketchbook ‚Äì –∞–ª—å–±–æ–º –¥–ª—è —Ä–∏—Å—É–Ω–∫–æ–≤; building ‚Äì –∑–¥–∞–Ω–∏–µ; several ‚Äì –Ω–µ—Å–∫–æ–ª—å–∫–æ.",
    examples:[
      "My favourite hobby is drawing.",
      "I sometimes draw in the park.",
      "I play the guitar in the evening."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Choose T/F.",
        questions:[
          {
            text:"The writer‚Äôs favourite hobby is dancing.",
            options:["True","False"],
            correct:1
          },
          {
            text:"He sometimes draws outside in the park.",
            options:["True","False"],
            correct:0
          },
          {
            text:"Hobbies help him relax after school.",
            options:["True","False"],
            correct:0
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice",
        desc:"Answer the questions.",
        questions:[
          {
            text:"What does he like drawing?",
            options:[
              "Only cars.",
              "Animals and people.",
              "Only numbers."
            ],
            correct:1
          },
          {
            text:"What musical instrument does he play?",
            options:["The piano.","The guitar.","The violin."],
            correct:1
          },
          {
            text:"When does he usually play the guitar?",
            options:["In the morning.","In the evening.","At school."],
            correct:1
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary",
        desc:"Choose the correct word.",
        questions:[
          {
            text:"An album where you draw is called‚Ä¶",
            options:["textbook","sketchbook","notebook"],
            correct:1
          },
          {
            text:"If colours are 'bright', they are‚Ä¶",
            options:["very light and strong.","dark and dirty.","invisible."],
            correct:0
          },
          {
            text:"Hobbies help him forget about‚Ä¶",
            options:["friends.","difficult tests.","music."],
            correct:1
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose the main idea.",
        questions:[
          {
            text:"The text is about‚Ä¶",
            options:[
              "different school subjects.",
              "the writer‚Äôs hobbies and why he likes them.",
              "rules in the park."
            ],
            correct:1
          }
        ]
      }
    ]
  },
  {
    id:5,
    name:"Food",
    level:"Beginner",
    title:"Food and Drinks",
    readingText:"I try to eat healthy food most of the time. For breakfast I usually have porridge or eggs and a cup of tea. At school I eat an apple or a sandwich during the break. For lunch we often have soup and salad at home. I like sweets and fast food too, but I don‚Äôt eat them every day. I know that vegetables, fruit and water are good for my body.",
    vocab:"porridge ‚Äì –∫–∞—à–∞; break ‚Äì –ø–µ—Ä–µ–º–µ–Ω–∞; body ‚Äì –æ—Ä–≥–∞–Ω–∏–∑–º.",
    examples:[
      "I usually have porridge or eggs for breakfast.",
      "At school I eat an apple or a sandwich.",
      "Vegetables and fruit are good for my body."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Mark T/F.",
        questions:[
          {
            text:"The writer always eats fast food for breakfast.",
            options:["True","False"],
            correct:1
          },
          {
            text:"He sometimes eats an apple at school.",
            options:["True","False"],
            correct:0
          },
          {
            text:"He knows that vegetables are healthy.",
            options:["True","False"],
            correct:0
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice",
        desc:"Answer the questions.",
        questions:[
          {
            text:"What does he usually have for breakfast?",
            options:[
              "Porridge or eggs and tea.",
              "Only chocolate.",
              "Nothing."
            ],
            correct:0
          },
          {
            text:"What does he often eat for lunch?",
            options:[
              "Soup and salad.",
              "Only ice cream.",
              "Only bread."
            ],
            correct:0
          },
          {
            text:"How often does he eat sweets and fast food?",
            options:[
              "Every day.",
              "Sometimes, but not every day.",
              "Never."],
            correct:1
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary",
        desc:"Choose the correct word from the text.",
        questions:[
          {
            text:"The Russian word for 'porridge' is‚Ä¶",
            options:["–∫–∞—à–∞","—Å—É–ø","—è–π—Ü–æ"],
            correct:0
          },
          {
            text:"A short rest between lessons is a‚Ä¶",
            options:["break","dinner","holiday"],
            correct:0
          },
          {
            text:"Good food and water are good for your‚Ä¶",
            options:["phone","body","bedroom"],
            correct:1
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose.",
        questions:[
          {
            text:"The text is mainly about‚Ä¶",
            options:[
              "an unhealthy lifestyle.",
              "eating healthy food most of the time.",
              "history of fast food."
            ],
            correct:1
          }
        ]
      }
    ]
  },
  {
    id:6,
    name:"School Day",
    level:"Beginner",
    title:"My School Day",
    readingText:"On weekdays I get up at seven o‚Äôclock. I wash my face, get dressed and have a quick breakfast. Then I go to school on foot because it is near my house. Our lessons start at eight. We usually have Maths, Kazakh, Russian, English and PE. After school I come home, have lunch and do my homework. In the evening I can relax, watch a little TV or read a book.",
    vocab:"on foot ‚Äì –ø–µ—à–∫–æ–º; near ‚Äì —Ä—è–¥–æ–º; lesson ‚Äì —É—Ä–æ–∫.",
    examples:[
      "I go to school on foot.",
      "Our lessons start at eight.",
      "In the evening I can relax."
    ],
    exercises:[
      {
        title:"Ex 1. True or False",
        desc:"Choose T/F.",
        questions:[
          {
            text:"The writer gets up at nine o‚Äôclock.",
            options:["True","False"],
            correct:1
          },
          {
            text:"School is near the house.",
            options:["True","False"],
            correct:0
          },
          {
            text:"He always goes to school by bus.",
            options:["True","False"],
            correct:1
          }
        ]
      },
      {
        title:"Ex 2. Multiple choice",
        desc:"Answer the questions.",
        questions:[
          {
            text:"How does he go to school?",
            options:["By car.","On foot.","By train."],
            correct:1
          },
          {
            text:"What lessons does he usually have?",
            options:[
              "Maths, languages and PE.",
              "Only Music and Art.",
              "No lessons."
            ],
            correct:0
          },
          {
            text:"What does he do after school?",
            options:[
              "Has lunch and does homework.",
              "Goes straight to bed.",
              "Plays games all day."
            ],
            correct:0
          }
        ]
      },
      {
        title:"Ex 3. Vocabulary",
        desc:"Choose the correct meaning.",
        questions:[
          {
            text:"If you go 'on foot', you‚Ä¶",
            options:["go by car.","walk.","fly."],
            correct:1
          },
          {
            text:"If something is 'near', it is‚Ä¶",
            options:["far away.","very expensive.","close to you."],
            correct:2
          },
          {
            text:"A 'lesson' is‚Ä¶",
            options:[
              "a school class.",
              "a type of food.",
              "a football match."
            ],
            correct:0
          }
        ]
      },
      {
        title:"Ex 4. Main idea",
        desc:"Choose.",
        questions:[
          {
            text:"The text is about‚Ä¶",
            options:[
              "a weekend trip.",
              "a usual school day.",
              "an exam at university."
            ],
            correct:1
          }
        ]
      }
    ]
  }
];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null; // {name, code, classLabel, stars, lastLogin}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}
function studentKey(code){
  return "bayan_reading_student_"+code;
}

function loadStudent(code,name,classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data=null;
  }
  if(!data){
    data = {
      name:name||"",
      code,
      classLabel,
      stars:0,
      lastLogin:null
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key,JSON.stringify(data));
  return data;
}
function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key,JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");
  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  // TEACHER
  if(codeStr==="3244"){
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 3244`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }
  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num,name,classLabel);
  saveCurrent();
  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );
  buildMainMenu();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginCode").value = "";
  document.getElementById("loginName").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  document.getElementById("menuInfo").innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;
  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";
  topics.forEach(t=>{
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#a5621c";
    div.style.borderColor = color+"55";
    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="topic-card-sub">${t.level}</div>
    `;
    div.addEventListener("click",()=>openTopic(t.id));
    grid.appendChild(div);
  });
  updateTopStars();
}

/* ---------- TOPIC SCREEN ---------- */

function openTopic(id){
  currentTopicId = id;
  const t = topics.find(x=>x.id===id);
  if(!t) return;

  const color = topicColors[id] || "#6d3b0f";
  document.documentElement.style.setProperty("--topicColor",color);

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;
  document.getElementById("topicHeaderTag").innerHTML =
    `<span class="tag">${t.level}</span>`;

  // READING BOX
  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const box = document.createElement("div");
  box.className = "reading-box";
  box.innerHTML = `
    <strong>Reading text:</strong>
    <p>${t.readingText}</p>
    ${t.vocab ? `<div class="reading-vocab"><strong>Words:</strong> ${t.vocab}</div>` : ""}
  `;
  rc.appendChild(box);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e=>{
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  // EXERCISES (MCQ / T-F –∏–º–∏—Ç–∏—Ä—É–µ—Ç—Å—è)
  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";
  if(!t.exercises || t.exercises.length===0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    const wrapper = document.createElement("div");
    wrapper.className = "exercises";
    t.exercises.forEach((ex,exIndex)=>{
      const block = document.createElement("div");
      block.className = "exercise-block";

      const title = document.createElement("div");
      title.className = "exercise-title";
      title.textContent = ex.title;
      block.appendChild(title);

      const desc = document.createElement("div");
      desc.className = "exercise-desc";
      desc.textContent = ex.desc || "";
      block.appendChild(desc);

      ex.questions.forEach((q,qIndex)=>{
        const row = document.createElement("div");
        row.className = "question-row";

        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";
        q.options.forEach((opt,optIndex)=>{
          const label = document.createElement("label");
          const radio = document.createElement("input");
          radio.type = "radio";
          const gname = `t${id}_e${exIndex}_q${qIndex}`;
          radio.name = gname;
          radio.value = optIndex;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(" "+opt));
          opts.appendChild(label);
        });
        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";
      const small = document.createElement("small");
      small.textContent = "Each correct answer gives you 1 star. One attempt for this exercise.";
      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click",()=>checkExercise(id,exIndex));
      footer.appendChild(small);
      footer.appendChild(btn);
      block.appendChild(footer);

      wrapper.appendChild(block);
    });
    ec.appendChild(wrapper);
  }

  document.getElementById("topicStatus").textContent = "";
  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

function printCurrentTopic(){
  if(!currentTopicId) return;
  window.print();
}

/* ---------- CHECK EXERCISES (1 –ø–æ–ø—ã—Ç–∫–∞) ---------- */

function checkExercise(topicId, exIndex){
  if(!currentUser) return;

  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  const key = `done_reading_t${topicId}_e${exIndex}_code${currentUser.code}`;
  if(localStorage.getItem(key) === "1"){
    const statusAlready = document.getElementById("topicStatus");
    if(statusAlready){
      statusAlready.textContent = "You have already completed this exercise.";
    }
    disableExercise(topicId, exIndex);
    return;
  }

  let gained = 0;
  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);
    if(!markEl) return;
    markEl.textContent = "";
    markEl.classList.remove("correct","wrong");

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }
    const chosen = Number(selected.value);
    if(chosen === q.correct){
      markEl.textContent = "‚úì";
      markEl.classList.add("correct");
      gained++;
    }else{
      markEl.textContent = "‚úó";
      markEl.classList.add("wrong");
    }
  });

  localStorage.setItem(key,"1");

  const status = document.getElementById("topicStatus");
  if(gained>0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    if(status){
      status.textContent = `Exercise completed. You gained ${gained} star(s).`;
    }
  }else{
    if(status){
      status.textContent = "Exercise completed. No correct answers.";
    }
  }

  disableExercise(topicId, exIndex);
}

function disableExercise(topicId, exIndex){
  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const inputs = document.querySelectorAll(`input[name="${gname}"]`);
    inputs.forEach(inp => inp.disabled = true);
  });

  const blocks = document.querySelectorAll("#topicExercisesContainer .exercise-block");
  const block = blocks[exIndex];
  if(block){
    const btn = block.querySelector("button");
    if(btn){
      btn.disabled = true;
      btn.style.opacity = "0.6";
      btn.style.cursor = "not-allowed";
    }
  }
}

/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";
  const allStudents = [];
  classRanges.forEach(r=>{
    for(let code=r.from; code<=r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){ data=null; }
      if(data) allStudents.push(data);
    }
  });
  if(allStudents.length===0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent =
      "No student data in this browser yet. Ask students to log in and work with tasks.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }
  allStudents.sort((a,b)=>a.code-b.code);
  allStudents.forEach(s=>{
    const tr = document.createElement("tr");
    const cls = document.createElement("td");
    cls.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";
    tr.appendChild(cls);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tbody.appendChild(tr);
  });
}

/* ---------- UPDATE STARS IN HEADER & MENU ---------- */
function updateTopStars(){
  if(!currentUser) return;
  const topStarsEl = document.getElementById("topStars");
  if(topStarsEl){
    topStarsEl.textContent = currentUser.stars ?? 0;
  }
  const menuStarsEl = document.getElementById("menuStars");
  if(menuStarsEl){
    menuStarsEl.textContent = currentUser.stars ?? 0;
  }
}

/* ---------- INIT ---------- */
showOnly("loginScreen");
</script>
</body>
</html>
