<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ENGLISH WITH AI BAYAN ‚Äì Beginner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --blue-main:#005b73;
      --blue-soft:#008a9e;
      --gold:#ffd54f;
      --bg:#f3f7fa;
      --topicColor:#005b73;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      background:var(--bg);
      color:#043042;
    }

    /* HEADER WITH GIRL LOGO */
    header{
      background:linear-gradient(90deg,#005b73,#008a9e);
      color:#fff;
      padding:10px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 2px 6px rgba(0,0,0,.2);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }

    .logo-img{
      width:50px;
      height:50px;
      border-radius:50%;
      object-fit:cover;
      border:3px solid var(--gold);
      background:white;
    }

    .brand-text h1{
      font-size:18px;
      letter-spacing:.04em;
    }

    .brand-text span{
      font-size:12px;
      opacity:.9;
    }

    .top-info{
      font-size:13px;
      text-align:right;
    }
    .top-info strong{color:var(--gold);}

    main{
      padding:16px;
      max-width:1300px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:20px;
    }

    .hidden{display:none !important;}

    .section-title{
      font-size:18px;
      margin-bottom:10px;
      font-weight:600;
    }
    .muted{
      color:#607080;
      font-size:12px;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }

    .text-input{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #c9d5df;
      margin-bottom:14px;
      font-size:14px;
    }
    .text-input:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.2);
    }

    .btn{
      border:none;
      border-radius:10px;
      padding:10px 18px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
    }
    .btn-primary{
      background:var(--blue-soft);
      color:#fff;
    }
    .btn-primary:hover{background:#007487;}
    .btn-ghost{
      background:#eef5f9;
      color:var(--blue-main);
    }
    .btn-ghost:hover{background:#dde9f1;}

    .login-note{
      font-size:12px;
      color:#526675;
      margin-top:10px;
      line-height:1.4;
    }

    .error{
      margin-top:10px;
      color:#b00020;
      font-size:13px;
    }

    /* SCREENS */
    #loginScreen{
      max-width:520px;
      margin:40px auto;
    }

    #mainMenuScreen{
      display:grid;
      grid-template-columns:2fr 1.2fr;
      gap:16px;
    }
    @media(max-width:960px){
      #mainMenuScreen{
        grid-template-columns:1fr;
      }
    }

    .tag{
      display:inline-block;
      padding:2px 6px;
      border-radius:999px;
      background:#e3f2fd;
      font-size:11px;
      color:#005b73;
    }

    .top-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
    }

    .stars-badge{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#fff9e5;
      border:1px solid #ffe082;
      font-size:12px;
    }
    .star-icon{color:#ffb300;}

    .topics-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media(max-width:700px){
      .topics-grid{grid-template-columns:1fr;}
    }

    .topic-card{
      border-radius:12px;
      border:1px solid #dde5ee;
      padding:10px 12px;
      background:#f8fafc;
      cursor:pointer;
      transition:.15s;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-card:hover{
      background:#e3f2fd;
      transform:translateY(-1px);
    }
    .topic-card-title{
      font-size:14px;
      font-weight:600;
    }
    .topic-card-sub{
      font-size:11px;
      color:#607080;
    }

    /* AI PANEL (demo) */
    #aiPanel{
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:260px;
    }
    #aiPanel h3{
      font-size:15px;
      margin-bottom:4px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
    }
    #aiLimit{
      font-size:11px;
    }
    .chat-note{
      font-size:11px;
      color:#607080;
    }
    .chat-box{
      flex:1;
      border-radius:10px;
      border:1px solid #dde5ee;
      padding:8px;
      background:#f8fafc;
      font-size:13px;
      overflow-y:auto;
    }
    .chat-msg{
      margin-bottom:6px;
      line-height:1.4;
    }
    .chat-msg strong{color:#005b73;}
    #aiQuestion{
      width:100%;
      min-height:60px;
      resize:vertical;
      border-radius:10px;
      border:1px solid #c9d5df;
      padding:8px;
      font-size:13px;
      margin-top:4px;
    }
    #aiQuestion:focus{
      outline:none;
      border-color:var(--blue-soft);
      box-shadow:0 0 0 2px rgba(0,138,158,.17);
    }
    .chat-actions{
      display:flex;
      justify-content:flex-end;
      margin-top:4px;
    }

    /* TOPIC SCREEN */
    #topicScreen{
      max-width:1000px;
      margin:0 auto;
    }
    .topic-header{
      border-radius:16px 16px 0 0;
      padding:14px 16px;
      background:linear-gradient(90deg,var(--topicColor),#007d99);
      color:#fff;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .topic-header-main{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .topic-header-title{
      font-size:18px;
      font-weight:600;
    }
    .topic-header-tag{
      font-size:11px;
      opacity:.9;
    }
    .topic-header-buttons{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
    }
    .btn-topic{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-topic.back{
      background:#ffffff;
      color:var(--topicColor);
    }
    .btn-topic.menu{
      background:rgba(255,255,255,.15);
      color:#fff;
      border:1px solid rgba(255,255,255,.5);
    }

    .topic-body{
      background:#fff;
      border-radius:0 0 16px 16px;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
      padding:16px;
    }

    .grammar-box{
      background:#f7fbff;
      border-left:4px solid var(--topicColor);
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:12px;
      font-size:14px;
      line-height:1.5;
    }
    .grammar-box strong{color:#005b73;}
    .formula{
      font-family:"Consolas","Courier New",monospace;
      background:#e3f2fd;
      padding:3px 6px;
      border-radius:6px;
      margin-right:4px;
      display:inline-block;
      margin-top:4px;
    }
    .examples{
      margin-top:8px;
      font-size:13px;
    }
    .examples li{
      margin-left:18px;
      margin-bottom:2px;
    }
    .grammar-ru{
      margin-top:10px;
      font-size:13px;
      color:#24313f;
    }

    .exercises{
      margin-top:12px;
    }
    .exercise-block{
      border-radius:12px;
      background:#f8fafc;
      padding:10px 12px;
      margin-bottom:10px;
      border:1px solid #dde5ee;
    }
    .exercise-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:6px;
    }
    .question-row{
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap:6px;
    }
    .question-text{
      flex:1 1 160px;
    }
    .options{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      align-items:center;
    }
    .options label{
      background:#ffffff;
      border-radius:999px;
      border:1px solid #ccd7e3;
      padding:2px 8px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:3px;
    }
    .options input[type="radio"]{
      accent-color:var(--topicColor);
    }
    .mark{
      width:18px;
      text-align:center;
      font-size:16px;
      font-weight:700;
    }
    .mark.correct{color:#2e7d32;}
    .mark.wrong{color:#c62828;}
    .exercise-footer{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .exercise-footer small{
      font-size:11px;
      color:#607080;
    }

    /* TEACHER */
    #teacherScreen{
      margin-top:20px;
    }
    .top-buttons{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .table-wrapper{
      overflow-x:auto;
    }
    table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
      margin-top:10px;
    }
    th,td{
      border:1px solid #dde5ee;
      padding:6px 8px;
      text-align:left;
      white-space:nowrap;
    }
    th{
      background:#eef5f9;
      font-weight:600;
    }

    /* PRINT: only topic */
    @media print{
      header, #loginScreen, #mainMenuScreen, #teacherScreen{
        display:none !important;
      }
      body{
        background:#fff;
      }
      #topicScreen{
        display:block !important;
        margin:0;
        padding:0;
      }
      .topic-body{
        box-shadow:none;
        border-radius:0;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <img src="logo.png" alt="AI Bayan" class="logo-img">
    <div class="brand-text">
      <h1>ENGLISH WITH AI BAYAN</h1>
      <span>Beginner ¬∑ stars ¬∑ interactive topics</span>
    </div>
  </div>
  <div class="top-info" id="topInfo">Not logged in</div>
</header>

<main>
  <!-- LOGIN -->
  <section id="loginScreen" class="card">
    <h2 class="section-title">Login</h2>
    <p class="muted" style="margin-bottom:10px">
      Enter your <strong>Name</strong> and <strong>Code</strong>. Ask your teacher for the code.
    </p>

    <label class="field-label" for="loginName">Name</label>
    <input id="loginName" class="text-input" type="text" placeholder="Your name" />

    <label class="field-label" for="loginCode">Code</label>
    <input id="loginCode" class="text-input" type="password" placeholder="Student or teacher code" />

    <div style="display:flex;gap:8px;margin-top:4px">
      <button class="btn btn-primary" onclick="handleLogin()">Login</button>
      <button class="btn btn-ghost" onclick="backToLogin()">Reset</button>
    </div>

    <div id="loginError" class="error hidden"></div>
  </section>

  <!-- MAIN MENU (STUDENT) -->
  <section id="mainMenuScreen" class="hidden">
    <section class="card">
      <div class="top-row">
        <div>
          <h2 class="section-title" style="margin-bottom:4px;">Beginner topics</h2>
          <div id="menuInfo" class="muted"></div>
        </div>
        <div>
          <span class="stars-badge">
            <span class="star-icon">‚≠ê</span>
            Stars: <span id="menuStars">0</span>
          </span>
        </div>
      </div>

      <div class="topics-grid" id="menuTopics"></div>
    </section>

    <aside id="aiPanel">
      <div>
        <h3>
          AI Bayan
          <span id="aiLimit"></span>
        </h3>
        <p class="chat-note">
          Demo mode. AI chat will be added later.
        </p>
      </div>

      <div id="chatBox" class="chat-box"></div>

      <div>
        <textarea id="aiQuestion"
                  placeholder="AI chat will be available soon."
                  disabled></textarea>
        <div class="chat-actions">
          <button class="btn btn-primary" id="askBtn" disabled>Ask (soon)</button>
        </div>
        <p class="chat-note">
          Your questions will be visible for the teacher in the future version.
        </p>
      </div>
    </aside>
  </section>

    <!-- TOPIC SCREEN -->
  <section id="topicScreen" class="hidden">
    <div class="topic-header">
      <div class="topic-header-main">
        <div class="topic-header-title" id="topicHeaderTitle">Topic</div>
        <div class="topic-header-tag" id="topicHeaderTag"></div>
      </div>
      <div class="topic-header-buttons">
        <button class="btn-topic back" onclick="backToMenu()">‚Üê Back</button>
        <button class="btn-topic menu" onclick="backToMenu()">üè† Main menu</button>
        <button class="btn-topic menu" onclick="printCurrentTopic()">üñ® Print</button>
      </div>
    </div>
    <div class="topic-body">
      <div id="topicRuleContainer"></div>
      <div id="topicExercisesContainer"></div>
      <div id="topicStatus" class="muted" style="margin-top:8px;"></div>
    </div>
  </section>

  <!-- TEACHER -->
  <section id="teacherScreen" class="hidden card">
    <div class="top-buttons">
      <button class="btn btn-ghost" onclick="backToLogin()">‚Üê Back to login</button>
      <span class="tag">Teacher mode</span>
    </div>
    <h2 class="section-title">Teacher dashboard</h2>
    <p class="muted">
      Shows data saved in this browser: stars and last login (per code).
    </p>

    <div class="table-wrapper">
      <table id="teacherTable">
        <thead>
        <tr>
          <th>Class</th>
          <th>Code</th>
          <th>Name</th>
          <th>Stars</th>
          <th>Last login</th>
        </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script>
/* ---------- CLASS RANGES (PIN) ---------- */

const classRanges = [
  { cls: "3E",  from: 101,  to: 115 },
  { cls: "4G",  from: 201,  to: 215 },
  { cls: "5G",  from: 301,  to: 315 },
  { cls: "5Zh", from: 401,  to: 415 },
  { cls: "6G",  from: 501,  to: 515 },
  { cls: "7B",  from: 601,  to: 615 },
  { cls: "7V",  from: 701,  to: 715 },
  { cls: "8E",  from: 801,  to: 815 },
  { cls: "9Zh", from: 901,  to: 915 },
  { cls: "10A", from: 1001, to: 1015 }
];

function getClassByCode(num){
  for (const r of classRanges){
    if (num >= r.from && num <= r.to){
      return r.cls;
    }
  }
  return null;
}

/* ---------- TOPIC COLORS ---------- */

const topicColors = {
  1: "#FF7A00",  // –æ—Ä–∞–Ω–∂–µ–≤—ã–π
  2: "#FF2400",  // –∫—Ä–∞—Å–Ω—ã–π –∞–ª—ã–π
  3: "#2ECC71",  // –∑–µ–ª–µ–Ω—ã–π
  4: "#FF00A8",  // —Ñ—É–∫—Å–∏—è
  5: "#8B4513",  // –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π
  6: "#007BFF",  // —Å–∏–Ω–∏–π
  7: "#FFD500",  // –∂–µ–ª—Ç—ã–π
  8: "#006D77",  // —Ç–µ–º–Ω–æ –±–∏—Ä—é–∑–æ–≤—ã–π
  9: "#800020",  // –±–æ—Ä–¥–æ–≤—ã–π
  10:"#C7F000",  // –ª–∞–π–º
  11:"#9D4EDD",  // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
  12:"#FF6F61",  // –∫–æ—Ä–∞–ª–ª–æ–≤—ã–π
  13:"#009B77",  // –∏–∑—É–º—Ä—É–¥–Ω—ã–π
  14:"#E2725B",  // —Ç–µ—Ä—Ä–∞–∫–æ—Ç–æ–≤—ã–π
  15:"#4A4A4A",  // —Ç–µ–º–Ω–æ —Å–µ—Ä—ã–π
  16:"#4C5866",  // –º–∞—Ä–µ–Ω–≥–æ
  17:"#0A5C5A",  // –º—É—Ä–µ–Ω–∞
  18:"#8E4585",  // —Å–ª–∏–≤–æ–≤—ã–π
  19:"#0B6623",  // —Ç–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π
  20:"#B22222"   // –∫–∏—Ä–ø–∏—á–Ω—ã–π
};

 /* ----- DATA: READING TOPICS (6 –ø—Ä–∏–º–µ—Ä–æ–≤; –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ 20) ----- */
    const topics = [
      {
        id:1,
        name:"My School Day",
        level:"Beginner",
        title:"A Busy School Day",
        text:"My name is Aigerim and I am eleven years old. I usually get up at seven o‚Äôclock. I have breakfast with my family and then I walk to school with my friend Dana. Our lessons start at eight. We have Maths, English and PE in the morning. I like English best because we play games and speak a lot. We usually finish school at one o‚Äôclock. In the afternoon I do my homework, help my mum and then I watch a little TV or chat with my friends online. I always go to bed before ten.",
        vocab:"finish ‚Äì –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å; before ‚Äì –ø–µ—Ä–µ–¥; online ‚Äì –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"Read the sentences. Are they true (T) or false (F)?",
            items:[
              { text:"Aigerim is eleven years old.", answer:true },
              { text:"She goes to school by bus.", answer:false },
              { text:"She likes English best.", answer:true },
              { text:"She usually finishes school at four o‚Äôclock.", answer:false }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer (A, B or C).",
            items:[
              {
                q:"Who does Aigerim go to school with?",
                options:["With her brother.","With her friend Dana.","With her neighbour."],
                correct:1
              },
              {
                q:"What lessons does she have in the morning?",
                options:["Maths, English and PE.","Science and History.","Art and Music."],
                correct:0
              },
              {
                q:"What does she like doing in English lessons?",
                options:["Writing long tests.","Listening to the teacher only.","Playing games and speaking."],
                correct:2
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the best word to complete the sentence.",
            items:[
              {
                q:"She usually gets up ___ seven o‚Äôclock.",
                options:["at","in","on"],
                correct:0
              },
              {
                q:"She walks to school ___ her friend.",
                options:["with","for","from"],
                correct:0
              },
              {
                q:"She goes to bed ___ ten.",
                options:["after","before","between"],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"What is the main idea of the text?",
            items:[
              {
                q:"Choose the best title.",
                options:[
                  "Aigerim‚Äôs favourite school subject.",
                  "Aigerim‚Äôs free time at the weekend.",
                  "Aigerim‚Äôs typical school day."
                ],
                correct:2
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Match the parts of the text with the information.",
            items:[
              {
                q:"The beginning of the text is mostly about‚Ä¶",
                options:["Aigerim‚Äôs evening.","Aigerim‚Äôs morning and school.","A trip to another city."],
                correct:1
              },
              {
                q:"The middle of the text is about‚Ä¶",
                options:["Her favourite subject.","Her pet.","Her grandparents."],
                correct:0
              },
              {
                q:"The end of the text is about‚Ä¶",
                options:["What she does after school.","Her friends‚Äô hobbies.","Her summer holidays."],
                correct:0
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put the events in the correct order (1‚Äì4).",
            items:[
              { text:"She does her homework and helps her mum.", order:3 },
              { text:"She has breakfast with her family.", order:1 },
              { text:"She walks to school with Dana.", order:2 },
              { text:"She watches TV or chats online.", order:4 }
            ]
          }
        ]
      },
      {
        id:2,
        name:"My Best Friend",
        level:"Beginner",
        title:"My Best Friend Timur",
        text:"My best friend‚Äôs name is Timur. He is in my class. Timur is tall and slim. He has short dark hair and big brown eyes. He is very friendly and always helps other students. We usually sit together in English lessons. After school we sometimes play football in the yard or go to the park. Timur loves computer games, but he never forgets to do his homework. When I have a problem, I can always talk to him.",
        vocab:"slim ‚Äì —Å—Ç—Ä–æ–π–Ω—ã–π; friendly ‚Äì –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π; yard ‚Äì –¥–≤–æ—Ä.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"Are the sentences true (T) or false (F)?",
            items:[
              { text:"Timur is in another school.", answer:false },
              { text:"He is tall and slim.", answer:true },
              { text:"He is unfriendly and rude.", answer:false },
              { text:"He loves computer games.", answer:true }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer.",
            items:[
              {
                q:"Where do the friends usually sit together?",
                options:["In Maths lessons.","In English lessons.","In PE lessons."],
                correct:1
              },
              {
                q:"What do they sometimes do after school?",
                options:["Play football or go to the park.","Study in the library.","Go shopping."],
                correct:0
              },
              {
                q:"What can the writer do when he has a problem?",
                options:["Ignore it.","Talk to Timur.","Talk only to the teacher."],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the word that best completes the sentence.",
            items:[
              {
                q:"Timur always helps ___ students.",
                options:["other","another","others"],
                correct:0
              },
              {
                q:"They sometimes play football ___ the yard.",
                options:["in","on","at"],
                correct:0
              },
              {
                q:"He never forgets ___ his homework.",
                options:["does","doing","to do"],
                correct:2
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"Choose the best sentence that describes the text.",
            items:[
              {
                q:"The text is mainly about‚Ä¶",
                options:[
                  "Timur‚Äôs favourite computer games.",
                  "Timur‚Äôs appearance and character as a good friend.",
                  "A football match in the park."
                ],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Answer about parts of the text.",
            items:[
              {
                q:"The first part of the text describes‚Ä¶",
                options:["what Timur looks like.","where they play.","their school rules."],
                correct:0
              },
              {
                q:"The middle of the text describes‚Ä¶",
                options:["Timur‚Äôs family.","their activities together.","a school trip."],
                correct:1
              },
              {
                q:"The last sentence shows‚Ä¶",
                options:["that Timur is a very important friend.","that they don‚Äôt talk much.","that Timur hates problems."],
                correct:0
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put these ideas in the order they appear in the text.",
            items:[
              { text:"Timur‚Äôs appearance is described.", order:2 },
              { text:"The writer explains he can talk to Timur about problems.", order:4 },
              { text:"We learn Timur is in the same class.", order:1 },
              { text:"We read about what they do after school.", order:3 }
            ]
          }
        ]
      },
      {
        id:3,
        name:"Rainy Sunday",
        level:"Beginner",
        title:"A Rainy Sunday at Home",
        text:"On Sunday the weather was terrible. It was cold, rainy and windy, so my family stayed at home. In the morning my mum baked apple pies in the kitchen. They smelled wonderful. My dad read a book in the living room. My sister and I did our homework and then played board games. After lunch we watched a funny film together. In the evening we drank hot tea with pie and talked. It was a quiet but very cosy day.",
        vocab:"terrible ‚Äì —É–∂–∞—Å–Ω—ã–π; smelled ‚Äì –ø–∞—Ö–ª–∏; cosy ‚Äì —É—é—Ç–Ω—ã–π.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"Decide if the sentences are true (T) or false (F).",
            items:[
              { text:"The weather was sunny and hot.", answer:false },
              { text:"The family stayed at home.", answer:true },
              { text:"The children played board games.", answer:true },
              { text:"In the evening they went to the cinema.", answer:false }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer.",
            items:[
              {
                q:"Why did the family stay at home?",
                options:["Because the weather was terrible.","Because the TV was broken.","Because it was a holiday."],
                correct:0
              },
              {
                q:"What did the mum do?",
                options:["She read a book.","She baked apple pies.","She went shopping."],
                correct:1
              },
              {
                q:"What did they do after lunch?",
                options:["Watched a film.","Cleaned the house.","Went for a walk."],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the best word.",
            items:[
              {
                q:"The pies ___ wonderful.",
                options:["smelled","looked","sounded"],
                correct:0
              },
              {
                q:"They watched a ___ film.",
                options:["quiet","funny","boring"],
                correct:1
              },
              {
                q:"It was a quiet but very ___ day.",
                options:["cosy","cold","dangerous"],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"What is the main idea of the text?",
            items:[
              {
                q:"The text shows that‚Ä¶",
                options:[
                  "a rainy day can still be nice at home.",
                  "rainy days are always boring.",
                  "the family likes travelling."
                ],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Answer about different parts of the story.",
            items:[
              {
                q:"The beginning describes‚Ä¶",
                options:["the evening.","the weather and the decision to stay home.","the lunch."],
                correct:1
              },
              {
                q:"The middle part describes‚Ä¶",
                options:["what everyone does at home.","a trip to the city.","a school day."],
                correct:0
              },
              {
                q:"The end of the text describes‚Ä¶",
                options:["the next morning.","the evening with tea and talking.","their neighbours."],
                correct:1
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put the events in the correct order.",
            items:[
              { text:"They watched a funny film.", order:3 },
              { text:"Mum baked apple pies.", order:1 },
              { text:"The children did homework and played board games.", order:2 },
              { text:"They drank hot tea and talked.", order:4 }
            ]
          }
        ]
      },
      {
        id:4,
        name:"Visit to Granny",
        level:"Beginner",
        title:"Weekend at Granny‚Äôs House",
        text:"Every month I visit my granny in the village. She lives in a small but beautiful house with a big garden. In the morning we feed the chickens and water the flowers. Sometimes we pick apples and berries. My granny cooks very tasty soup and homemade bread. In the evening we sit on the bench in front of the house and watch the stars. I love these quiet weekends.",
        vocab:"pick ‚Äì —Å–æ–±–∏—Ä–∞—Ç—å; homemade ‚Äì –¥–æ–º–∞—à–Ω–∏–π; bench ‚Äì —Å–∫–∞–º–µ–π–∫–∞.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"True (T) or false (F)?",
            items:[
              { text:"The writer visits granny every week.", answer:false },
              { text:"Granny has a big garden.", answer:true },
              { text:"They watch TV every evening.", answer:false },
              { text:"The writer likes these weekends.", answer:true }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer.",
            items:[
              {
                q:"Where does granny live?",
                options:["In a village.","In the city centre.","Near the sea."],
                correct:0
              },
              {
                q:"What do they do in the morning?",
                options:["Go to school.","Feed chickens and water flowers.","Sleep all day."],
                correct:1
              },
              {
                q:"What do they watch in the evening?",
                options:["The stars.","The river.","Cars."],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the best word.",
            items:[
              {
                q:"Granny lives in a small but ___ house.",
                options:["ugly","beautiful","dirty"],
                correct:1
              },
              {
                q:"They sometimes pick apples and ___.",
                options:["trees","books","berries"],
                correct:2
              },
              {
                q:"The bread is ___.",
                options:["homemade","fast","cold"],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"Choose the best sentence.",
            items:[
              {
                q:"The text is mostly about‚Ä¶",
                options:[
                  "a noisy weekend in the city.",
                  "quiet and happy weekends at granny‚Äôs house.",
                  "a difficult school day."
                ],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Answer about the parts.",
            items:[
              {
                q:"The first part tells us about‚Ä¶",
                options:["how often the writer visits and where granny lives.","what they eat.","who lives next door."],
                correct:0
              },
              {
                q:"The middle part tells us about‚Ä¶",
                options:["school subjects.","their morning work and food.","a TV show."],
                correct:1
              },
              {
                q:"The last sentence shows‚Ä¶",
                options:["the writer doesn‚Äôt like the weekends.","the writer loves these weekends.","the writer wants to move to the city."],
                correct:1
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put the ideas in order.",
            items:[
              { text:"They sit on the bench and watch the stars.", order:4 },
              { text:"They feed the chickens.", order:2 },
              { text:"We learn that the writer visits granny every month.", order:1 },
              { text:"They eat tasty soup and bread.", order:3 }
            ]
          }
        ]
      },
      {
        id:5,
        name:"Four Seasons",
        level:"Beginner",
        title:"The Four Seasons",
        text:"There are four seasons in a year: spring, summer, autumn and winter. In spring the weather gets warmer and trees become green. Many people feel happy after a long winter. In summer it is usually hot. Children have holidays and often go to camps, the sea or the village. Autumn is a colourful season with yellow and red leaves. It is time to go back to school. In winter it is cold and snowy. We can play snowballs, skate and drink hot tea at home.",
        vocab:"become ‚Äì —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è; leaves ‚Äì –ª–∏—Å—Ç—å—è; snowballs ‚Äì —Å–Ω–µ–∂–∫–∏.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"Read and mark T/F.",
            items:[
              { text:"In spring the weather gets colder.", answer:false },
              { text:"In summer children often have holidays.", answer:true },
              { text:"Autumn is a colourful season.", answer:true },
              { text:"In winter it is usually very hot.", answer:false }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer.",
            items:[
              {
                q:"What happens in spring?",
                options:["Trees become green.","Leaves become black.","It starts to snow."],
                correct:0
              },
              {
                q:"Where can children go in summer?",
                options:["Only to school.","To camps or the sea.","Nowhere."],
                correct:1
              },
              {
                q:"What can we do in winter?",
                options:["Swim in the river.","Play snowballs and skate.","Plant flowers."],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the correct missing word.",
            items:[
              {
                q:"Autumn is a ___ season.",
                options:["colourful","boring","empty"],
                correct:0
              },
              {
                q:"In winter it is cold and ___.",
                options:["green","snowy","windy only"],
                correct:1
              },
              {
                q:"In summer children often go on ___.",
                options:["homework","holidays","lessons"],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"Choose the best title.",
            items:[
              {
                q:"The text is about‚Ä¶",
                options:[
                  "different sports in winter.",
                  "what people eat in summer.",
                  "the four seasons and what people do."
                ],
                correct:2
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Answer about parts.",
            items:[
              {
                q:"The first part tells us‚Ä¶",
                options:["only about winter.","the names of all seasons and spring.","about a trip."],
                correct:1
              },
              {
                q:"The middle part tells us‚Ä¶",
                options:["about summer and autumn.","about granny‚Äôs village.","about shopping."],
                correct:0
              },
              {
                q:"The last part tells us‚Ä¶",
                options:["about winter activities.","about breakfast.","about tests at school."],
                correct:0
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put the seasons in the order they appear in the text.",
            items:[
              { text:"Summer ‚Äì children have holidays.", order:2 },
              { text:"Winter ‚Äì we play snowballs.", order:4 },
              { text:"Autumn ‚Äì colourful leaves.", order:3 },
              { text:"Spring ‚Äì trees become green.", order:1 }
            ]
          }
        ]
      },
      {
        id:6,
        name:"New Student",
        level:"Beginner",
        title:"A New Student in Our Class",
        text:"This year we have a new student in our class. His name is Daniel and he comes from another city. On the first day he was very quiet and a little nervous. Our teacher asked everybody to introduce themselves. After the lesson I showed Daniel the canteen and the gym. Now he has many friends and he often laughs in class. He says our class is friendly and he is happy here.",
        vocab:"quiet ‚Äì —Ç–∏—Ö–∏–π; nervous ‚Äì –Ω–µ—Ä–≤–Ω—ã–π; introduce ‚Äì –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è.",
        exercises:[
          {
            type:"trueFalse",
            title:"Ex 1. True or False",
            desc:"Are these sentences true (T) or false (F)?",
            items:[
              { text:"Daniel comes from the same city.", answer:false },
              { text:"He was nervous on the first day.", answer:true },
              { text:"The writer showed him the canteen.", answer:true },
              { text:"Now Daniel has no friends.", answer:false }
            ]
          },
          {
            type:"mcq",
            title:"Ex 2. Multiple choice",
            desc:"Choose the correct answer.",
            items:[
              {
                q:"What did the teacher ask the students to do?",
                options:["To introduce themselves.","To write a test.","To clean the classroom."],
                correct:0
              },
              {
                q:"Where did the writer take Daniel after the lesson?",
                options:["To the library and the office.","To the canteen and the gym.","Home."],
                correct:1
              },
              {
                q:"How does Daniel feel now?",
                options:["He is happy in this class.","He is still very nervous.","He wants to leave the school."],
                correct:0
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 3. Gap-fill",
            desc:"Choose the best word.",
            items:[
              {
                q:"Daniel is a new student in ___ class.",
                options:["our","his old","their"],
                correct:0
              },
              {
                q:"On the first day he was very ___ and nervous.",
                options:["noisy","quiet","angry"],
                correct:1
              },
              {
                q:"He says our class is ___.",
                options:["boring","strict","friendly"],
                correct:2
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 4. Main idea",
            desc:"Choose the best sentence.",
            items:[
              {
                q:"The main idea of the text is that‚Ä¶",
                options:[
                  "new students always feel bad.",
                  "a new student can become happy if the class is friendly.",
                  "teachers never help new students."
                ],
                correct:1
              }
            ]
          },
          {
            type:"mcq",
            title:"Ex 5. Parts of the text",
            desc:"Answer about different parts of the story.",
            items:[
              {
                q:"The beginning of the text tells us‚Ä¶",
                options:["Daniel‚Äôs hobbies.","that Daniel is new and from another city.","about summer holidays."],
                correct:1
              },
              {
                q:"The middle of the text tells us‚Ä¶",
                options:["about the first day and the tour of the school.","about tests.","about a football match."],
                correct:0
              },
              {
                q:"The last sentences tell us‚Ä¶",
                options:["that Daniel is unhappy.","that Daniel is happy and has friends.","that Daniel changed school again."],
                correct:1
              }
            ]
          },
          {
            type:"order",
            title:"Ex 6. Order of events",
            desc:"Put the events in the correct order.",
            items:[
              { text:"The teacher asks students to introduce themselves.", order:2 },
              { text:"Daniel was quiet and nervous.", order:1 },
              { text:"The writer shows Daniel the canteen and the gym.", order:3 },
              { text:"Daniel has many friends and feels happy.", order:4 }
            ]
          }
        ]
      }
    ];

/* ---------- STATE & STORAGE ---------- */

let currentUser = null; // {name, code, classLabel, stars, lastLogin}
let currentTopicId = null;

function todayStr(){
  return new Date().toISOString().slice(0,10);
}
function studentKey(code){
  return "bayan_student_"+code;
}

function loadStudent(code,name,classLabel){
  const key = studentKey(code);
  let data = null;
  try{
    data = JSON.parse(localStorage.getItem(key));
  }catch(e){
    data=null;
  }
  if(!data){
    data = {
      name:name||"",
      code,
      classLabel,
      stars:0,
      lastLogin:null
    };
  }else{
    if(name) data.name = name;
    data.classLabel = classLabel;
  }
  data.lastLogin = todayStr();
  localStorage.setItem(key,JSON.stringify(data));
  return data;
}
function saveCurrent(){
  if(!currentUser) return;
  const key = studentKey(currentUser.code);
  localStorage.setItem(key,JSON.stringify(currentUser));
}

/* ---------- SCREEN SWITCHING ---------- */

function showOnly(id){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("mainMenuScreen").classList.add("hidden");
  document.getElementById("topicScreen").classList.add("hidden");
  document.getElementById("teacherScreen").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}
function setTopInfo(html){
  document.getElementById("topInfo").innerHTML = html;
}

/* ---------- LOGIN ---------- */

function handleLogin(){
  const name = document.getElementById("loginName").value.trim();
  const codeStr = document.getElementById("loginCode").value.trim();
  const errorEl = document.getElementById("loginError");
  errorEl.classList.add("hidden");
  errorEl.textContent = "";

  if(!codeStr){
    errorEl.textContent = "Enter your code.";
    errorEl.classList.remove("hidden");
    return;
  }

  if(codeStr==="3234"){
    setTopInfo(`Logged in as <strong>TEACHER</strong> ¬∑ code 3234`);
    renderTeacherTable();
    showOnly("teacherScreen");
    return;
  }

  const num = Number(codeStr);
  if(!Number.isInteger(num)){
    errorEl.textContent = "Code must be a number.";
    errorEl.classList.remove("hidden");
    return;
  }
  const classLabel = getClassByCode(num);
  if(!classLabel){
    errorEl.textContent = "Unknown student code. Ask your teacher.";
    errorEl.classList.remove("hidden");
    return;
  }
  if(!name){
    errorEl.textContent = "Enter your name.";
    errorEl.classList.remove("hidden");
    return;
  }

  currentUser = loadStudent(num,name,classLabel);
  saveCurrent();
  setTopInfo(
    `Class <strong>${currentUser.classLabel}</strong> ¬∑ Student: <strong>${currentUser.name}</strong> (code ${currentUser.code}) ¬∑ Stars: <strong id="topStars">${currentUser.stars}</strong>`
  );
  buildMainMenu();
  updateTopStars();
  showOnly("mainMenuScreen");
}

function backToLogin(){
  currentUser = null;
  setTopInfo("Not logged in");
  document.getElementById("loginCode").value = "";
  document.getElementById("loginName").value = "";
  showOnly("loginScreen");
}

/* ---------- MAIN MENU UI ---------- */

function buildMainMenu(){
  if(!currentUser) return;
  document.getElementById("menuInfo").innerHTML =
    `Class <strong>${currentUser.classLabel}</strong>, student <strong>${currentUser.name}</strong> (code ${currentUser.code})`;
  document.getElementById("menuStars").textContent = currentUser.stars ?? 0;

  const grid = document.getElementById("menuTopics");
  grid.innerHTML = "";
  topics.forEach(t=>{
    const div = document.createElement("div");
    div.className = "topic-card";
    const color = topicColors[t.id] || "#005b73";
    div.style.borderColor = color+"55";
    div.style.background = "#f8fafc";
    div.innerHTML = `
      <div class="topic-card-title">${t.id}. ${t.title}</div>
      <div class="topic-card-sub">${t.level}</div>
    `;
    div.addEventListener("click",()=>openTopic(t.id));
    grid.appendChild(div);
  });

  // demo message in AI panel
  const chat = document.getElementById("chatBox");
  chat.innerHTML = "";
  const msg = document.createElement("div");
  msg.className = "chat-msg";
  msg.textContent = "AI Bayan chat will be available later. Now use topics and exercises.";
  chat.appendChild(msg);
  document.getElementById("aiLimit").textContent = "¬∑ demo mode";
}

/* ---------- TOPIC SCREEN ---------- */

function openTopic(id){
  currentTopicId = id;
  const t = topics.find(x=>x.id===id);
  if(!t) return;

  const color = topicColors[id] || "#005b73";
  document.documentElement.style.setProperty("--topicColor",color);
    // üîí –ï—Å–ª–∏ —É—á–µ–Ω–∏–∫ —É–∂–µ —Ä–µ—à–∞–ª –∫–∞–∫–∏–µ-—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ —ç—Ç–æ–π —Ç–µ–º–µ ‚Äì –±–ª–æ–∫–∏—Ä—É–µ–º –∏—Ö
    if(currentUser && t.exercises && t.exercises.length){
      t.exercises.forEach((ex, idx)=>{
        const key = `done_beginner_t${id}_e${idx}_code${currentUser.code}`;
        if(localStorage.getItem(key) === "1"){
          disableExercise(id, idx);
        }
      });
    }

  document.getElementById("topicHeaderTitle").textContent = `${id}. ${t.title}`;
  document.getElementById("topicHeaderTag").innerHTML =
    `<span class="tag">${t.level}</span>`;

  const rc = document.getElementById("topicRuleContainer");
  rc.innerHTML = "";
  const gbox = document.createElement("div");
  gbox.className = "grammar-box";
  gbox.innerHTML = `
    <strong>Rule (EN):</strong> ${t.explanation || ""}
    ${
      t.formulas && t.formulas.length
        ? "<div style='margin-top:6px;'>"+
          t.formulas.map(f=>`<span class="formula">${f}</span>`).join(" ")+
          "</div>"
        : ""
    }
    ${
      t.ruleRu || t.usageRu
        ? `<div class="grammar-ru">
             <strong>–ü—Ä–∞–≤–∏–ª–æ (RU):</strong><br>
             ${t.ruleRu||""}<br>${t.usageRu||""}
           </div>`
        : ""
    }
  `;
  rc.appendChild(gbox);

  if(t.examples && t.examples.length){
    const ul = document.createElement("ul");
    ul.className = "examples";
    t.examples.forEach(e=>{
      const li = document.createElement("li");
      li.textContent = e;
      ul.appendChild(li);
    });
    rc.appendChild(ul);
  }

  const ec = document.getElementById("topicExercisesContainer");
  ec.innerHTML = "";
  if(!t.exercises || t.exercises.length===0){
    const p = document.createElement("p");
    p.className = "muted";
    p.style.marginTop = "10px";
    p.textContent = "Exercises for this topic will be added later.";
    ec.appendChild(p);
  }else{
    const wrapper = document.createElement("div");
    wrapper.className = "exercises";
    t.exercises.forEach((ex,exIndex)=>{
      const block = document.createElement("div");
      block.className = "exercise-block";
      const title = document.createElement("div");
      title.className = "exercise-title";
      title.innerHTML = ex.title;
      block.appendChild(title);

      ex.questions.forEach((q,qIndex)=>{
        const row = document.createElement("div");
        row.className = "question-row";
        const qText = document.createElement("div");
        qText.className = "question-text";
        qText.textContent = `${qIndex+1}) ${q.text}`;
        row.appendChild(qText);

        const opts = document.createElement("div");
        opts.className = "options";
        q.options.forEach((opt,optIndex)=>{
          const label = document.createElement("label");
          const radio = document.createElement("input");
          radio.type = "radio";
          const gname = `t${id}_e${exIndex}_q${qIndex}`;
          radio.name = gname;
          radio.value = optIndex;
          label.appendChild(radio);
          label.appendChild(document.createTextNode(" "+opt));
          opts.appendChild(label);
        });
        row.appendChild(opts);

        const mark = document.createElement("span");
        mark.className = "mark";
        mark.id = `mark_t${id}_e${exIndex}_q${qIndex}`;
        row.appendChild(mark);

        block.appendChild(row);
      });

      const footer = document.createElement("div");
      footer.className = "exercise-footer";
      const small = document.createElement("small");
      small.textContent = "Each correct answer gives you 1 star.";
      const btn = document.createElement("button");
      btn.className = "btn btn-primary";
      btn.textContent = "Check";
      btn.addEventListener("click",()=>checkExercise(id,exIndex));
      footer.appendChild(small);
      footer.appendChild(btn);
      block.appendChild(footer);

      wrapper.appendChild(block);
    });
    ec.appendChild(wrapper);
  }

  showOnly("topicScreen");
}

function backToMenu(){
  if(!currentUser){
    backToLogin();
    return;
  }
  buildMainMenu();
  showOnly("mainMenuScreen");
}

function printCurrentTopic(){
  // –ö–Ω–æ–ø–∫–∞ –ø–µ—á–∞—Ç–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–º—ã,
  // –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—á–∞—Ç—å
  if(!currentTopicId) return;
  window.print();
}

function checkExercise(topicId, exIndex){
  if(!currentUser) return;

  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  // üîë —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á: –ë–ï–ì–ò–ù–ù–ï–† + —Ç–µ–º–∞ + —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ + –∫–æ–¥ —É—á–µ–Ω–∏–∫–∞
  const key = `done_beginner_t${topicId}_e${exIndex}_code${currentUser.code}`;

  // üõë –µ—Å–ª–∏ —É–∂–µ —Ä–µ—à–∞–ª ‚Äì –Ω–µ –¥–∞—ë–º –µ—â—ë —Ä–∞–∑
  if(localStorage.getItem(key) === "1"){
    const statusAlready = document.getElementById("topicStatus");
    if(statusAlready){
      statusAlready.textContent = "You have already completed this exercise.";
    }
    disableExercise(topicId, exIndex);
    return;
  }

  let gained = 0;
  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const selected = document.querySelector(`input[name="${gname}"]:checked`);
    const markEl = document.getElementById(`mark_t${topicId}_e${exIndex}_q${qIndex}`);
    if(!markEl) return;
    markEl.textContent = "";
    markEl.classList.remove("correct","wrong");

    if(!selected){
      markEl.textContent = "‚Ä¢";
      return;
    }
    const chosen = Number(selected.value);
    if(chosen===q.correct){
      markEl.textContent="‚úì";
      markEl.classList.add("correct");
      gained++;
    }else{
      markEl.textContent="‚úó";
      markEl.classList.add("wrong");
    }
  });

  // üìå –ø–æ–º–µ—á–∞–µ–º, —á—Ç–æ —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ —ç—Ç–∏–º —É—á–µ–Ω–∏–∫–æ–º
  localStorage.setItem(key, "1");

  const status = document.getElementById("topicStatus");
  if(gained>0){
    currentUser.stars += gained;
    saveCurrent();
    updateTopStars();
    if(status){
      status.textContent = `Exercise completed. You gained ${gained} star(s).`;
    }
  }else{
    if(status){
      status.textContent = "Exercise completed. No correct answers.";
    }
  }

  // üîí —Å—Ä–∞–∑—É –±–ª–æ–∫–∏—Ä—É–µ–º
  disableExercise(topicId, exIndex);
}
function disableExercise(topicId, exIndex){
  const t = topics.find(x=>x.id===topicId);
  if(!t) return;
  const ex = t.exercises[exIndex];
  if(!ex) return;

  // üö´ –û—Ç–∫–ª—é—á–∞–µ–º —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
  ex.questions.forEach((q,qIndex)=>{
    const gname = `t${topicId}_e${exIndex}_q${qIndex}`;
    const inputs = document.querySelectorAll(`input[name="${gname}"]`);
    inputs.forEach(inp => inp.disabled = true);
  });

  // üö´ –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "Check" —Ç–æ–ª—å–∫–æ —É —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞
  const blocks = document.querySelectorAll("#topicExercisesContainer .exercise-block");
  const block = blocks[exIndex];
  if(block){
    const btn = block.querySelector("button");
    if(btn){
      btn.disabled = true;
      btn.style.opacity = "0.6";
      btn.style.cursor = "not-allowed";
    }
  }
}
  
/* ---------- TEACHER TABLE ---------- */

function renderTeacherTable(){
  const tbody = document.querySelector("#teacherTable tbody");
  tbody.innerHTML = "";
  const allStudents = [];
  classRanges.forEach(r=>{
    for(let code=r.from; code<=r.to; code++){
      const key = studentKey(code);
      let data = null;
      try{
        data = JSON.parse(localStorage.getItem(key));
      }catch(e){ data=null; }
      if(data) allStudents.push(data);
    }
  });
  if(allStudents.length===0){
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.textContent =
      "No student data in this browser yet. Ask students to log in and work with tasks.";
    tr.appendChild(td);
    tbody.appendChild(tr);
    return;
  }
  allStudents.sort((a,b)=>a.code-b.code);
  allStudents.forEach(s=>{
    const tr = document.createElement("tr");
    const cls = document.createElement("td");
    cls.textContent = s.classLabel || getClassByCode(s.code) || "";
    const codeTd = document.createElement("td");
    codeTd.textContent = s.code;
    const nameTd = document.createElement("td");
    nameTd.textContent = s.name || "";
    const starsTd = document.createElement("td");
    starsTd.textContent = s.stars ?? 0;
    const loginTd = document.createElement("td");
    loginTd.textContent = s.lastLogin || "";
    tr.appendChild(cls);
    tr.appendChild(codeTd);
    tr.appendChild(nameTd);
    tr.appendChild(starsTd);
    tr.appendChild(loginTd);
    tbody.appendChild(tr);
  });
}

/* ---------- INIT ---------- */

showOnly("loginScreen");
  /* ----------- FIX: ADD updateTopStars FUNCTION ----------- */
function updateTopStars() {
  const topStars = document.getElementById("topStars");
  if (!topStars) return;

  const stars = localStorage.getItem("stars") || 0;
  topStars.textContent = "Stars: " + stars;
}
</script>
</body>
</html>
